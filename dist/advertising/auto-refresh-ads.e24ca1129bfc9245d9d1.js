"use strict";(self.cmlsAmpUtils=self.cmlsAmpUtils||[]).push([[812],{8324:function(e,s,t){t.r(s),t(4114),t(8992),t(3215),t(3949),t(7550);var i=t(8533);const{vD:o,k5:n,rE:l,no:r,pU:d}=i;d||(d=[]);const{Logger:E}=window.__CMLSINTERNAL.libs,h=new E(`${o} ${l}`);window.__CMLSINTERNAL?.initAutoRefreshAdsExclusion||(window.__CMLSINTERNAL.initAutoRefreshAdsExclusion=()=>{window._CMLS.autoRefreshAdsExclusion=window._CMLS?.autoRefreshAdsExclusion||[],window._CMLS.autoRefreshAdsExclusion?._push||(window._CMLS.autoRefreshAdsExclusion._push=window._CMLS.autoRefreshAdsExclusion.push,window._CMLS.autoRefreshAdsExclusion.push=function(...e){return e.forEach((e=>{this.includes(e)?h.warn("Attempted to add duplicate item to autoRefreshAdsExclusion list.",e):(h.info("New ID added to exclusion list",e),Array.prototype.push.apply(this,[e]))})),this.length})}),window.__CMLSINTERNAL.initAutoRefreshAdsExclusion(),window.__CMLSINTERNAL.clearAutoRefreshAdsExclusion=()=>{delete window._CMLS.autoRefreshAdsExclusion,window.__CMLSINTERNAL.initAutoRefreshAdsExclusion()};class a{log=h;every=r;globalConditions={DISABLED:"Auto-Refresh-Ads is disabled.",PAUSED:"Auto-Refresh-Ads is paused.",RUNNING:"Auto-Refresh-Ads is running."};slotConditions={OK:"Slot is good to refresh.",NEVER:"Slot is set to never refresh.",TARGET_NEVER:`Slot has ${this.TARGET_NEVER_REFRESH} targeting.`,ALWAYS:"Slot is set to always refresh.",TARGET_ALWAYS:`Slot has ${this.TARGET_ALWAYS_REFRESH} targeting.`,EXCLUDED:"Slot is excluded by autoRefreshAdsExclusion.",DISABLED:"Refresh is disabled for this slot.",HIDDEN:"Slot is not currently viewable."};TARGET_REFRESH_KEY=i.F3;TARGET_ALWAYS_REFRESH_KEY=i.Ck;TARGET_NEVER_REFRESH_KEY=i.rH;TARGET_TRUE=i.Jk;TARGET_SET=i.Xv;timers=new Map;interval=null;constructor(e=r){if(window?._CMLS?.autoRefreshAdsInterval>0?this.every=window._CMLS.autoRefreshAdsInterval:this.every=e,this.checkGlobalConditions()!==this.globalConditions.RUNNING)return h.info("Global condition check failed, will not refresh ads."),!1;const s=window.__CMLSINTERNAL.adTag;return h.debug("Adding impressionViewable listener. Refresh timer will be set per-slot once an impression is delivered."),s.addListener("impressionViewable",this.impressionListener.bind(this)),s.getSlots().forEach((e=>{this.slotIsExcluded(e)||!this.slotIsAlwaysRefresh(e)||this.slotHasRefreshSetKey(e)||this.slotHasTimer(e)||(h.debug(`Slot with div id ${e.getSlotElementId()} will always refresh`,window.__CMLSINTERNAL.adTag.listSlotData(e)),this.setSlotTimer(e))})),s.addListener("slotRenderEnded",(e=>{const s=e.slot;!this.slotIsAlwaysRefresh(s)||this.slotHasRefreshSetKey(s)||this.slotHasTimer(s)||this.setSlotTimer(s)})),this.interval=setInterval((()=>{this.tick.call(this)}),1e3),this}checkGlobalConditions(){const{DISABLED:e,PAUSED:s,RUNNING:t}=this.globalConditions,i=window.__CMLSINTERNAL?.autoReload;return window.DISABLE_AUTO_REFRESH_ADS?(h.warn("window.DISABLE_AUTO_REFRESH_ADS is set. Ads will not refresh."),e):0===window?._CMLS?.autoRefreshAdsInterval?(h.warn("Auto refresh ads disabled by window._CMLS.autoRefreshAdsInterval = 0"),e):i?.active&&i.settings.timeout<2*this.every?(h.warn("Auto-Reload-Page timer is less than 2x Auto-Refresh-Ads timer. Ads will not refresh"),e):t}impressionListener(e){const s=e.slot;h.debug("Impression viewable",{elementId:s.getSlotElementId(),pos:s.getTargeting("pos"),refresh:s.getTargeting(this.TARGET_REFRESH_KEY)}),this.slotIsExcluded(s)||this.slotHasRefreshSetKey(s)||this.slotHasTimer(s)||this.setSlotTimer(s)}slotHasRefreshKey(e){const s=e.getTargeting(this.TARGET_REFRESH_KEY);return s.includes(this.TARGET_TRUE)||s.includes(String(this.TARGET_TRUE))}slotHasRefreshSetKey(e){const s=e.getTargeting(this.TARGET_REFRESH_KEY);return s.includes(this.TARGET_SET)||s.includes(String(this.TARGET_SET))}slotIsAlwaysRefresh(e){const{ALWAYS:s,TARGET_ALWAYS:t}=this.slotConditions,i=e.getTargeting("pos");return e.getTargeting(this.TARGET_ALWAYS_REFRESH_KEY).includes(this.TARGET_TRUE)?t:!!d.some((e=>i.includes(e)))&&s}slotIsExcluded(e){void 0===window._CMLS.autoRefreshAdsExclusion&&window.__CMLSINTERNAL?.initAutoRefreshAdsExclusion();const s=e.getSlotElementId();return(window._CMLS.autoRefreshAdsExclusion.includes(s)||!!e.getTargeting(this.TARGET_REFRESH_KEY).includes(this.TARGET_NEVER_REFRESH_KEY))&&this.slotConditions.EXCLUDED}slotHasTimer(e){return this.timers.has(e)}setSlotTimer(e){const s=e.getSlotElementId(),t=e.getTargeting("pos"),i=new Date;i.setSeconds(i.getSeconds()+Math.max(i.getMilliseconds()/1e3));const o=new Date(i.getTime()+6e4*this.every);h.debug(`Setting ${this.every} minute refresh timer on slot.`,{pos:t,id:s},o.toLocaleString()),this.deleteSlotTimer(e),this.timers.set(e,o),e.setTargeting(this.TARGET_REFRESH_KEY,this.TARGET_SET)}deleteSlotTimer(e){this.timers.has(e)&&(clearTimeout(this.timers.get(e)),this.timers.delete(e),(this.slotHasRefreshSetKey(e)||this.slotHasRefreshKey(e))&&e.setTargeting(this.TARGET_REFRESH_KEY,this.TARGET_TRUE))}tick(){const e=new Date;e.getTime()%(6e4*this.every/4)<1e3&&h.debug("Tick",e.toLocaleString());const s=[],t=[];this.timers.forEach(((i,o)=>{if(this.slotIsExcluded(o))this.deleteSlotTimer(o);else if(e>=i){const e=o.getSlotElementId(),i=o.getTargeting("pos");h.debug("Queueing for refresh",{pos:i,id:e}),this.deleteSlotTimer(o),s.push(o),t.push(window.__CMLSINTERNAL.adTag.listSlotData(o))}})),s.length&&(h.debug(`${(new Date).toLocaleString()} Refreshing ${s.length} slots`,t),window.__CMLSINTERNAL.adTag.refresh(s))}destroy(){this.interval&&(clearInterval(this.interval),this.interval=null),this.timers.forEach(((e,s)=>{this.deleteSlotTimer(s)}))}}function R(){window.__CMLSINTERNAL[n]=new a,h.debug("Initialized.")}window.__CMLSINTERNAL.adTag?R():window.addEventListener("cmls-adtag-loaded",(()=>{R()}))}}]);